<head>
	<style type="text/css">
		body {
			font-family: "Atkinson Hyperlegible";
/*			background: linear-gradient(to bottom, rgba(137,185,136,0.25) 0%,rgba(255,255,255,1) 10%);*/
/*			background: linear-gradient(to bottom, #88b98a 0%,#ffffff 20%);*/
			margin: 0px auto;
			width: 1130px;
		}

		h1 {
			font-size: 38px;
			margin: 1.2em 1rem 1rem 1rem;
		}
		column-title {
			text-transform: uppercase;
			font-weight: bold;
			color: #7C7C7C;
			display: block;
		}
		column-title:not(:first-child) {
			margin: 30px 0px 20px 0px;
		}

		.month {
			display:none;
			width: 400px;
		}
		.month.active {
			display:block;
		}
		.month.next {
			display:block;
		}
		.month ul {
			padding-left: 15px;
		}
		.month li {
			margin-bottom: 10px;
/*			list-style-type: none;*/
		}
		.month li small{
			display: none;
			margin-top: 10px;
		}
		.month li input[type="checkbox" i] {
			position:absolute;
			margin-left: -24px;
		}
		forecast-chart {
			display: block;
			width: 100px;
			height: 100px;
		}
		.forecast-day {

		}
		/* current conditions */
		#current {
			display: flex;
		}
		current-info{
			margin-top: 40px;
		}
		current-icon {

		}
		current-icon .current_img {
			width: 124px;
			height: 124px;
			display: block;
		}
		current-text{
			display: block;
		}
		current-temp-f {
			font-size:42px;
			font-weight: bold;
		}
		current-temp-c {
			font-size:22px;
			font-weight: bold;
		}
		/* todays forecast */
		today-temps {
			display: flex;
			justify-content: space-between;
		}
		today-temp-high-f, today-temp-low-f {
			font-size:32px;
			font-weight: bold;
		}
		today-temp-high-c, today-temp-low-c {
			font-size:22px;
			font-weight: bold;
			opacity: 0.5;
		}
		
		/* 7 day forecast */
		.daily_img {
			width: 24px;
			height: 24px;
			display: inline;
		}
		#daily_forecast {
			position: relative;
		}
		#daily_forecast hr {
			position: absolute;
			border: none;
			border-bottom: 1px solid #E7E7E7;
			display: block;
			width: 93%;
			margin-top: 2px;
			z-index: -2;
		}
		#daily_forecast table {
			margin-top: 40px;
		}
		td.low {
		    position: relative;
    		top: -20px;
		}
		td.line {
			margin:0px 10px;
		}
		td.line svg {
		    position: relative;
    		top: -10;
    		z-index: 100;
		}

		log-entry {
			display: block;
			margin-top:20px;
		    border-top: 1px solid #E7E7E7;
    		padding-top: 20px;
		}
		entry-title {
			font-weight: bold;
			display: block;
		}
		entry-content {
display: block;
		}


		/*	grid	*/
		/* container */
		.responsive-three-column-grid {
		    display:block;
		}

		/* columns */
		.responsive-three-column-grid > page-column {
		    padding:1rem;
		    display: block;
		}

		/* tablet breakpoint */
		@media (min-width:768px) {
		    .responsive-three-column-grid {
		        display: grid;
		        grid-auto-rows: 1fr;
		        grid-template-columns: 1fr 1fr 1fr;
		    }
		}

	</style>
<!-- 	<script type="text/javascript">
		const latitude = 32.2309868363516;
		const longitude = -110.91850343900622;
	</script> -->
</head>
<body>
	<h1>01 March '25</h1>
	<div class="responsive-three-column-grid">
		<page-column id="log">
			<column-title>Grow log</column-title>
			<log-entry>
				<entry-title>28 Feb '25</entry-title>
				<entry-content>Sewed jalapeño near dead one next to cistern</entry-content>
			</log-item>

		</page-column>
		<page-column id="weather">
			<column-title>Current Conditions</column-title>
			<div id="current">
				<current-icon></current-icon>
				<current-info>
					<current-temp-f></current-temp-f>
					<current-temp-c></current-temp-c>
					<current-text></current-text>
				</current-info>
			</div>
			<column-title>Today's Forecast</column-title>
			<div id="today_forecast">
				<today-temps>
					<div>
						<today-temp-low-f></today-temp-low-f>
						<today-temp-low-c></today-temp-low-c>
					</div>
					<div>
						<today-temp-high-f></today-temp-high-f>
						<today-temp-high-c></today-temp-high-c>
					</div>
				</today-temps>
				<today-text></today-text>
			</div>
			<column-title>7 Day Forecast</column-title>
			<div id="daily_forecast">
				<table></table>
			</div>
		</page-column>
		<page-column id="guide">
			<column-title>Growing Guidance</column-title>
			<div id="January" class="month">
				<h2 class="month-name">January</h2>
				<p>Sow beets, lettuce, carrots, parsley, peas, radishes, spinach, turnips, onions, potatoes, cabbage, broccoli, kohlrabi, kale, Chinese cabbage, Chinese celery, cilantro, collards, leeks, mustard greens, Swiss chard</p>
				<p>Plant bare-root plants</p>
			</div>
			<div id="February" class="month">
				<h2 class="month-name">February</h2>
				<p>Plant beets, broccoli, cabbage, carrot, cauliflower, Chinese cabbage, Chinese celery, cilantro, collard, kale, kohlrabi, lettuce, mustard green, onion sets, pea, radish, spinach, Swiss chard, turnip, Jerusalem artichoke</p>
				<p>Plant bush beans, cucumbers, squash, dill, chard, and sweet corn late in the month</p>
				<p>Mulch potatoes and onion</p>
			</div>
			<div id="March" class="month">
				<h2 class="month-name">March</h2>
				<p>March 15 is traditionally the last day of frost. If the native velvet mesquite trees are leafing out that, too, is a good sign that we will now be frost free until fall.</p>
				<ul>
					<li>Last sowing of carrots, beets, and heat tolerant leaf lettuce</li>
					<li>Set out transplants of tomatoes and peppers</li>
					<li>Plant basil, squash, sweet corn, Lima beans, snap beans, cantaloupes, watermelon
					<small>
						If planting corn consider the traditional "three sisters" arrangement of corn, beans, and squash or melons together. The corn creates a trellis and shade. The beans fix nitrogen in the soil and grow up the corn. The squash or melons
						take advantage of the shade and nitrogen while creating a living-mulch over the ground to protect the soil.
					</small>
					</li>
					<li>After danger of frost you can plant Lima beans, black-eyed peas, cane sorghum, chilies, chiltepines, cotton, gourds, indigo, panic grass, teosinte, tobacco, tomatillos</li>
					<li>Mulch trees, shrubs, and vegetables (will retain moisture and lessen stress on plants as temperatures warm up</li>
					<li>Plant such annuals as marigolds to add color and deter pests from garden</li>
					<li>You may want to sow tall plants such as sunflowers and amaranth on the west side of your plot to screen other plants from the hot afternoon sun.</li>
				</ul>
				
			</div>
			<div id="April" class="month">
				<h2 class="month-name">April</h2>
				<p>
					Plant okra, asparagus, beans, cherry tomatoes, sunflowers, amaranth, cucumber, eggplant, melons, Lima beans, black-eyed peas, cane sorghum, chilies, chiltepines, cotton, gourds, indigo, panic grass, teosinte, tobacco, tomatillos,
					muskmelon
				</p>
				<p>Still not too late to plant pumpkins, cantelopes, squash</p>
				<p>Plant summer bulbs: caladium, anna, dahlia, glads, iris</p>
				<p>
					Warm-to-hot-season greens such as amaranth, purslane, lambsquarters, Malabar spinach, and Yakina Savoy lettuce can be sown now and grown through summer — all will appreciate afternoon shade from a tall trellis, native mesquite tree,
					or sunflowers to the west.
				</p>
			</div>
			<div id="May" class="month">
				<h2 class="month-name">May</h2>
				<p>Plant heat tolerant veggies: Lima beans, eggplants, peanuts, peppers, sweet potatoes</p>
			</div>
			<div id="June" class="month">
				<h2 class="month-name">June</h2>
				<p>Cover tomatoes with shade cloth or perhaps you have grown some shade</p>
				<p>Sow fall tomatoes indoors</p>
				<p>Make sure you have covered the soil with mulch to retain moisture and reduce plant stress</p>
			</div>
			<div id="July" class="month">
				<h2 class="month-name">July</h2>
				<p>With the monsoon rains plant tepary beans, devil’s claw, corn, purslane</p>
				<p>Start tomatoes, peppers, eggplants inside</p>
				<p>If you want, some folks now prune their tomato plants by 2/3</p>
				<p>Hand pollinate squash and melon flowers in the early morning or increase pollinator habitat and they’ll do the work for you</p>
				<p>
					With the first good summer rain, plant seed of native perennial plants within or beside water-harvesting earthworks, especially coyote gourds.<br />
					Wildlands Restoration is a great source for native Sonoran desert wildflower and restoration seed (Spadefoot Nursery and Native Seeds/SEARCH sell their seed).
				</p>
			</div>
			<div id="August" class="month">
				<h2 class="month-name">August</h2>
				<p>You can sow sweet corn again</p>
				<p>Set out tomato, pepper plants mid month</p>
				<p>Direct seed cucumbers and bush beans late in the month</p>
				<p>Set out transplants of broccoli, cabbage, and cauliflower</p>
			</div>
			<div id="September" class="month">
				<h2 class="month-name">September</h2>
				<p>Plant most greens such as spinach, lettuce, chard, collards, kale, mustard greens, etc.</p>
				<p>Plant garlic, carrots, onions, parsley, peas, cilantro, radishes, sweet peas, beets, broccoli, cabbage, Chinese cabbage and celery, turnips, garbanzos, lentils, desert chia, rutabaga, artichoke, and nasturtiums</p>
				<p>
					Start thinking about neighborhood street and shade tree planting programs. Contact Trees for Tucson 791-3109 and see
					<a href="https://dunbarspringneighborhoodforesters.org/plant-resources/recommended-native-tree-understory-plant-lists/">www.DunbarSpringNeighborhoodForesters.org</a> for recommended tree and understory plant lists.
				</p>
			</div>
			<div id="October" class="month">
				<h2 class="month-name">October</h2>
				<p>Plant carrots, beets, broccoli, spinach, garbanzos, lentils, desert chia, cilantro, peas, parsnip, salsify</p>
				<p>
					Sow native wildflowers.<br />
					Wildlands Restoration is a great source for native Sonoran desert wildflower and restoration seed (Spadefoot Nursery and Native Seeds/SEARCH sell their seed).
				</p>
			</div>
			<div id="November" class="month">
				<h2 class="month-name">November</h2>
				<p>Plant peas, fava beans, beets, carrots, lettuce, spinach, mustard, turnips, chard, horseradish, rhubarb</p>
				<p>Set out seedlings of celery, cabbage, broccoli, Brussel sprouts</p>
				<p>Plant hardy herbs like cilantro</p>
				<p>Plant hollyhocks, calendula, alyssum, bachelor buttons, freesias</p>
			</div>
			<div id="December" class="month">
				<h2 class="month-name">December</h2>
				<p>Late in month, start tomatoes, peppers, and eggplants indoors</p>
				<p>
					With the first good winter rain, <a href="https://dunbarspringneighborhoodforesters.org/welcome/planting-native-seeds-with-the-rains/">plant native wildflower seed within and beside water-harvesting earthworks</a>.<br />
					Wildlands Restoration is a great source for native Sonoran desert wildflower and restoration seed (Spadefoot Nursery and Native Seeds/SEARCH sell their seed).
				</p>
			</div>
		</col-umn>
	<forecast-chart></forecast-chart>
	<!-- <template> id=""</template> -->
	<!-- <img src="https://forecast.weather.gov/meteograms/Plotter.php?lat=32.2219&lon=-110.9712&wfo=TWC&zcode=AZZ504&gset=20&gdiff=9&unit=0&tinfo=MN7&ahour=0&pcmd=10001111100000000000000000000000000000000000000000000000000&lg=en&indu=1!1!1!&dd=&bw=&hrspan=48&pqpfhr=6&psnwhr=6"> -->
	<script type="text/javascript">
		// growing guidance
		const month = ["January","February","March","April","May","June","July","August","September","October","November","December"];

		const month_num = (new Date()).getMonth();
		const next_month_num = month_num + 1 < 12 ? month_num + 1 : 0;

		let this_month = month[month_num];
		let next_month = month[next_month_num];

		let this_month_el = document.querySelector("#" + this_month);
		let next_month_el = document.querySelector("#" + next_month);

		this_month_el.classList.add("active")
		next_month_el.classList.add("next")


		// weather
		const latitude = 32.2219
		const longitude = -110.9712

		const weather_icons_path = "weather-icons/production/fill/svg-static/"
		// const weather_icons_path_line = "weather-icons/production/fill/svg-static/"
		const weather_icons_path_line = "svg-static/"
		const weather_icons_url = "weather-icons-wmo.json"
		const nws_xml_url = `https://forecast.weather.gov/MapClick.php?lat=${latitude}&lon=${longitude}&unit=0&lg=english&FcstType=dwml`
		const open_meteo_url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,is_day,precipitation,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset,daylight_duration,precipitation_sum,precipitation_probability_max&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=America%2FDenver`
		let om_data, nws_data, weather_icons;

		function init() {
			console.log("loaded");

			Promise.all([
				fetch(open_meteo_url).then(resp => resp.json()).then(json => om_data = json),
				fetch(weather_icons_url).then(resp => resp.json()).then(json => weather_icons = json),
				fetch(nws_xml_url).then(resp => resp.text()).then(text => nws_data = parseXML(text)),
			])
			.then(go)
			.catch(error => {
				console.log(error);
			});
		}
// 
		// let temptemph = [20, 65, 80, 0, 10, 100, 75]
		// let temptempl = [0, -3, 40, 0, -9, 75, 15]

		function go() {
			console.log("all loaded")
			console.log(`nws_data:`, nws_data);

		    let worded = nws_data.querySelector("wordedForecast").querySelector("text").innerHTML
		    console.log(`worded:`, worded);

			document.querySelector("today-text").innerText = worded

			let current_is_day = om_data.current.is_day ? "day" : "night"
			let weather_state = weather_icons[om_data.current.weather_code][current_is_day]
			document.querySelector("current-icon").innerHTML = `<img class="current_img" src="${weather_icons_path}${weather_state.icon}">`
			document.querySelector("current-text").innerText = weather_state.description
			let temp_color = get_temp_color(Math.round(om_data.current.temperature_2m))
			let temp_rgb = `rgb(${temp_color[0]}, ${temp_color[1]}, ${temp_color[2]})`
			document.querySelector("current-temp-f").innerHTML = `
				<span style="color: ${temp_rgb};">${Math.round(om_data.current.temperature_2m)}&deg;F</span>
			`
			// console.log(`linear-gradient(to bottom, rgba(${temp_color[0]},${temp_color[1]},${temp_color[2]},0.5) 0%,rgba(255,255,255,1) 10%);`);
			document.querySelector("body").style["background"] = `linear-gradient(to bottom, rgba(${temp_color[0]},${temp_color[1]},${temp_color[2]},0.5) 0%,rgba(255,255,255,1) 10%)`
			console.log(`document.querySelector("body"):`, document.querySelector("body").style.background);

			document.querySelector("current-temp-c").innerHTML = `<span style="color: ${temp_rgb}; opacity:0.5;">${FtoC(om_data.current.temperature_2m)}&deg;C</span>`
			
			let today_lo = Math.round(om_data.daily.temperature_2m_min[0])
			let today_hi = Math.round(om_data.daily.temperature_2m_max[0])
			let today_lo_color = rgbToHex(get_temp_color(today_lo));
			let today_hi_color = rgbToHex(get_temp_color(today_hi));

			document.querySelector("today-temp-high-f").innerHTML = 
				`<span style="color: ${today_hi_color}">${today_hi}&deg;F`
			document.querySelector("today-temp-high-c").innerHTML = 
				`<span style="color: ${today_hi_color}">${FtoC(today_hi)}&deg;C`
			document.querySelector("today-temp-low-f").innerHTML = 
				`<span style="color: ${today_lo_color}">${today_lo}&deg;F`
			document.querySelector("today-temp-low-c").innerHTML = 
				`<span style="color: ${today_lo_color}">${FtoC(today_lo)}&deg;C`
			
			today_forecast = document.querySelector("#today_forecast");

			const weekday = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

			let table = document.querySelector("#daily_forecast table")
			
			
			om_data.daily.time.forEach((date, day) => {
				let dow = (new Date(date+"T00:00")).getDay();
				let row = document.createElement("tr")

				let col_low = document.createElement("td")
				col_low.classList.add("low")
				col_low.innerHTML = Math.round(om_data.daily.temperature_2m_min[day])
				row.appendChild(col_low)

				if (day == 0) {
					let col_line = document.createElement("td")
					col_line.classList.add("line")
					col_line.setAttribute("rowspan", om_data.daily.time.length)
					row.appendChild(col_line)
				}

				let col_hi = document.createElement("td")
				col_hi.classList.add("hi")
				col_hi.innerHTML = Math.round(om_data.daily.temperature_2m_max[day])
				row.appendChild(col_hi)

				let col_icon = document.createElement("td")
				col_icon.classList.add("icon")
				col_icon.innerHTML = `<img class="daily_img" title="${weather_icons[om_data.daily.weather_code[day]]["day"].description}" 
					src="${weather_icons_path_line}${weather_icons[om_data.daily.weather_code[day]]["day"].icon}">`
				row.appendChild(col_icon)

				let col_dow = document.createElement("td")
				col_dow.classList.add("dow")
				col_dow.innerHTML = weekday[dow]
				row.appendChild(col_dow)

				table.appendChild(row)
			})
			build_weather_path();

		}

		const temp_gradient = [
			[ 0, "#2d094f"],
			[ 9, "#5222a5"],
			[19, "#1675fa"],
			[33, "#57cbf3"],
			[50, "#63d5cd"],
			[70, "#f8cd1b"],
			[77, "#f0aa1d"],
			[89, "#cc2619"],
			[97, "#5d1b08"],
		];

		const TEMP_MAX = 131;
		const TEMP_MIN = -40;

		function build_weather_path() {
			// weather path	
			let container = document.querySelector("#daily_forecast table .line");
			let x_padding = 20;
			let y_padding = 10;
			let y_spacing = 20;
			let width = document.querySelector("#daily_forecast").offsetWidth - 75;
			let height = 14 * y_spacing;

			let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">`
			let coords = "";

			let min_week_temp = Math.min.apply(0, om_data.daily.temperature_2m_min);
			let max_week_temp = Math.max.apply(0, om_data.daily.temperature_2m_max);

			// let min_week_temp = Math.min.apply(0, temptempl);
			// let max_week_temp = Math.max.apply(0, temptemph);

			let dots = "";

			om_data.daily.temperature_2m_min.forEach((min, id) => {
				// weather line
				let ii = id * 2;
				
				let min_temp = min
				let max_temp = om_data.daily.temperature_2m_max[id]

				let max_pos = normalize(max_temp, max_week_temp, min_week_temp) * (width-x_padding*2) + x_padding;
				let min_pos = normalize(min_temp, max_week_temp, min_week_temp) * (width-x_padding*2) + x_padding;
				console.log(`min_pos:`, min_temp, min_pos);
			    
			    let minx = min_pos
			    let miny = ii * y_spacing + y_padding
			    let maxx = max_pos
			    let maxy = (ii+1) * y_spacing + y_padding

			    // coords += `${minx} ${miny}`;
			    // coords += ` L${maxx} ${maxy}`;

			    if(coords === "") {
			    	coords += `M${minx},${miny} `;
			    	coords += `S${minx},${miny - y_spacing} ${minx},${miny} `;
				} else {
					coords += `S${minx},${miny - y_spacing} ${minx},${miny} `;
				}
				coords += `S${maxx},${maxy - y_spacing} ${maxx},${maxy} `;

			    


			    // day dividers have to be html
			    let line = document.createElement("hr")
			    line.style.top = id * y_spacing * 2
			    container.appendChild(line)

			    dots += `<circle cx="${minx}" cy="${miny}" r="5" stroke="white" stroke-width="2" fill="${rgbToHex(get_temp_color(min_temp))}" />`;
			    dots += `<circle cx="${maxx}" cy="${maxy}" r="5" stroke="white" stroke-width="2" fill="${rgbToHex(get_temp_color(max_temp))}" />`;

			})

			let week_min_normalized = get_temp_in_range(min_week_temp) * 100;
			let week_max_normalized = get_temp_in_range(max_week_temp) * 100;
			console.log(`week_min_normalized:`, week_min_normalized);
			console.log(`week_max_normalized:`, week_max_normalized);

			// document.querySelector("#daily_forecast").innerHTML += `<span style="font-size: 48px; font-weight: bold;color: ${rgbToHex(get_temp_color(min_week_temp))};">${Math.round(min_week_temp)}&deg;F</span>`

			// let grad_dist = Math.abs(week_max_normalized) - Math.abs(week_min_normalized);
			// let grad_min = -(week_min_normalized - TEMP_MIN)/grad_dist * 100;
			// let grad_max = 100 + ((TEMP_MAX - week_max_normalized)/grad_dist * 100)
			// console.log(`grad_min, grad_max:`, grad_min, grad_max);
			// console.log(`week_max_normalized, TEMP_MAX, grad_dist`, week_max_normalized, TEMP_MAX, grad_dist);

			let grad_min = min_week_temp - TEMP_MIN;
			let grad_max = TEMP_MAX - max_week_temp;

			console.log(`grad_min, grad_max:`, grad_min, grad_max);

			let defs = `
				<defs>
					<linearGradient id="grad5" x1="-${grad_min+15}%" y1="50%" x2="${100+grad_max +15}%" y2="50%">
						${temp_gradient.map(stop => `<stop offset='${stop[0] / 100}' stop-color='${stop[1]}'/>`).join("")}
					</linearGradient>
				</defs>
			`;
			let weather_path = `<path d="${coords}" fill="none" stroke="url(#grad5)" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" ></path>`;
			svg += `
					${defs}
					${weather_path}
					${dots}
				</svg>
			`;
			document.querySelector("#daily_forecast table .line").innerHTML += svg


		}



		const get_temp_in_range = (temp) => normalize(temp, TEMP_MAX, TEMP_MIN)

		function get_temp_color(temp) {

			let normalized_temp = get_temp_in_range(temp) * 100;

			var colorRange = [];
	        temp_gradient.every((val, id) => {
	            if(normalized_temp <= val[0]) {
	                colorRange = [id-1, id]
	                return false;
	            }
	            return true;
	        });
	        
	        //Get the two closest colors
	        var firstcolor = temp_gradient[colorRange[0]][1];
	        var secondcolor = temp_gradient[colorRange[1]][1];
	        
	        //Get the color with pickHex(thx, less.js's mix function!)
	        return pickHex( 
	        	hexToRgb(secondcolor), 
	        	hexToRgb(firstcolor), 
	        	normalize(
	        		normalized_temp, 
	        		temp_gradient[colorRange[1]][0], 
	        		temp_gradient[colorRange[0]][0]
	        	)

	        );
		}

		

		function parseResponses(rtexts) {
			// todo do this by mime type in promise
			rtexts.forEach(rtext => {
				console.log(`rtext[0]:`, rtext[0]);
				if (rtext[0] == "<") {
					parseXML(rtext)
				} else {
					parseJSON(rtext)
				}
			})
			
		}

		function parseJSON(json) {
			const obj = JSON.parse(json);
			console.log(`obj:`, obj);
		}

		function parseXML(xml) {
		    const parser = new DOMParser();
		    const xmlDoc = parser.parseFromString(xml, "text/xml");
		    return xmlDoc
		    // console.log(xmlDoc.documentElement.nodeName);
		    // console.log(xmlDoc.documentElement);
		    // let forecast = xmlDoc.querySelector("data[type='forecast']")
		    // console.log("forecast", forecast)

		    // let lows_data = xmlDoc.querySelector("temperature[type='minimum']")
		    // let lows = Array.from(lows_data.querySelectorAll("value"))
		    // 	.map(low => parseInt(low.childNodes[0].nodeValue))
		    // console.log("lows", lows)
		    // let highs_data = xmlDoc.querySelector("temperature[type='maximum']")
		    // let highs = Array.from(highs_data.querySelectorAll("value"))
		    // 	.map(high => parseInt(high.childNodes[0].nodeValue))
		    // console.log("both", interleave(lows, highs))

		    // time layouts
		    let time_layouts = {};
		    Array
	    	.from(xmlDoc.querySelectorAll("time-layout"))
	    	.forEach(cond => {
	    		let key = cond.querySelector("layout-key").childNodes[0].nodeValue
	    		// console.log(`key:`, key);
	    		let this_layout = {};
	    		time_layouts[key] = Array
	    			.from(cond.querySelectorAll("start-valid-time"))
	    			.map(time_el => {
	    				// console.log(`time_el:`, time_el);
	    				return {
	    					name: time_el.getAttribute("period-name"), 
	    					time: time_el.childNodes[0].nodeValue
	    				}
	    			})
	    	});
		    console.log(`time_layouts:`, time_layouts);



		    // let weather = xmlDoc.querySelector("weather[time-layout='k-p12h-n14-1'")
		    // let conditions = Array
		    // 	.from(weather.querySelectorAll("weather-conditions"))
		    // 	.map(cond => cond.getAttribute("weather-summary"))
		    // conditions.forEach()
		    // console.log(`conditions:`, conditions);
		}

		const interleave = ([ x, ...xs ], ys = []) =>
			x === undefined
				? ys  
				: [ x, ...interleave (ys, xs) ];

		const one_decimal = (num) => Math.round(num * 100) / 100;
		const FtoC = (F) => Math.round((F-32) / 1.8);

		const normalize = (val, max, min) => (val - min) / (max - min); 

		function pickHex(color1, color2, weight) {
		    var p = weight;
		    var w = p * 2 - 1;
		    var w1 = (w/1+1) / 2;
		    var w2 = 1 - w1;
		    var rgb = [Math.round(color1[0] * w1 + color2[0] * w2),
		        Math.round(color1[1] * w1 + color2[1] * w2),
		        Math.round(color1[2] * w1 + color2[2] * w2)];
		    return rgb;
		}

		const hexToRgb = (hex) => {
		    let r = parseInt(hex.slice(1, 3), 16);
		    let g = parseInt(hex.slice(3, 5), 16);
		    let b = parseInt(hex.slice(5, 7), 16);
		    return [r, g, b];
		};

		const rgbToHex = (rgb) => '#' + [rgb[0], rgb[1], rgb[2]].map(x => {
  			const hex = x.toString(16)
  			return hex.length === 1 ? '0' + hex : hex
		}).join('')

		// SPARKLINES
		/* Open in Val Town: https://www.val.town/v/stevekrouse/sparklineSVG */
		function sparklineSVG({ strokeWidth, data, height, width, fill, stroke }) {
		  let vb_width = data.length - 1;
		  let vb_height = Math.max(...data);
		  let path = [
		    "M",
		    ...data.map((value, i) => {
		      let x = i;
		      let y = vb_height - value;
		      return `${x} ${y}${i < vb_width ? " L " : ""}`;
		    }),
		  ];
		  let closedPath = [...path, ` L ${vb_width} ${vb_height} L 0 ${vb_height} Z`];
		  return `
		        <svg height="${height}" width="${width}" viewBox="0 0 ${vb_width} ${vb_height}" preserveAspectRatio="none" role="img" xmlns="http://www.w3.org/2000/svg">
		            <path d="${
		    closedPath.join("")
		  }" stroke="transparent" fill="${fill}" />
		            <path d="${
		    path.join("")
		  }" stroke-width="${strokeWidth}" vector-effect="non-scaling-stroke" stroke="${stroke}" fill="transparent" />
		        </svg>
		        `;
		}
		// Forked from https://jsfiddle.net/buk3dsqv/

		init();

	</script>
</body>
